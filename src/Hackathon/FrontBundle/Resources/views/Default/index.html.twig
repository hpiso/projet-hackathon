{% extends 'HackathonFrontBundle::layout.html.twig' %}

{% block content %}
    <div id="popup"></div>
    <div align="center" class="zoneRecherche">
        <div id="google_autocompleter"></div>
        <div class="blocRecherche">
            {{ form_start(form) }}
            {{ form_widget(form.Recherche, {'attr': {'class': 'ac_input'} }) }}
            <input class="btnForm" type="submit" id="rechercher" value="Recherche">
            {{ form_end(form) }}
        </div>
    </div>
    <div class="blocMenu">
        <ul id="menu">
            <li>
                <a href="javascript:void(0)" class="drop" id="drop1">Catégorie</a>
                <div class="dropdown_5columns">
                    <ul>
                        <li ><a id="rating1" class="click">Toute catégorie</a></li>
                        <li ><a id="rating2" class="categorie">Culture</a></li>
                        <li ><a id="rating3" class="categorie">Sport</a></li>
                        <li ><a id="rating4" class="categorie">Bar</a></li>
                        <li ><a id="rating5" class="categorie">Gastronomie</a></li>
                    </ul>
                </div>
            </li>
            <li>
                <a href="javascript:void(0)" class="drop" id="drop2">Avis</a>
                <div class="dropdown_4columns">
                    <ul>
                        <li><a id="equipemente1" class=" click">Indifférent</a></li>
                        <li><a id="equipemente2" class="equipement">5 étoiles</a></li>
                        <li><a id="equipemente3" class="equipement">4 étoiles</a></li>
                        <li><a id="equipemente4" class="equipement">3 étoiles</a></li>
                        <li><a id="equipemente5" class="equipement">2 étoiles</a></li>
                        <li><a id="equipemente6" class="equipement">1 étoile</a></li>
                    </ul>
                </div>
            </li>
            <li><a href="javascript:void(0)" class="drop" id="drop3">Distance</a>
                <div class="dropdown_3columns">
                    <ul>
                        <li><a class="thematique click" id="thematiquee1">Indifférent</a></li>
                        <li><a class="thematique" id="thematiquee1">< 1km</a></li>
                        <li><a class="thematique" id="thematiquee2">entre 1 et 2 km</a></li>
                        <li><a class="thematique" id="thematiquee3">entre 2 et 5 km</a></li>
                    </ul>
                </div>
            </li>
        </ul>
    </div>




    <div id="center_div">
        <div id="up_btn" style="position: absolute;top:0px;left:49%;z-index:100;cursor: pointer;">
            <img src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjY0cHgiIGhlaWdodD0iNjRweCIgdmlld0JveD0iMCAwIDMwNy4wNTQgMzA3LjA1NCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMzA3LjA1NCAzMDcuMDU0OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnPgoJPGcgaWQ9Il94MzRfODUuX1VwIj4KCQk8Zz4KCQkJPHBhdGggZD0iTTMwMi40NDUsMjA1Ljc4OEwxNjQuNjMsNjcuOTU5Yy02LjEzNi02LjEzLTE2LjA3NC02LjEzLTIyLjIwMywwTDQuNTk3LDIwNS43ODhjLTYuMTI5LDYuMTMyLTYuMTI5LDE2LjA2OSwwLDIyLjIwMSAgICAgbDExLjEwMSwxMS4xMDFjNi4xMjksNi4xMzYsMTYuMDc2LDYuMTM2LDIyLjIwOSwwbDExNS42Mi0xMTUuNjI2TDI2OS4xNTEsMjM5LjA5YzYuMTI4LDYuMTM2LDE2LjA3LDYuMTM2LDIyLjIwMSwwICAgICBsMTEuMTAxLTExLjEwMUMzMDguNTg5LDIyMS44NSwzMDguNTg5LDIxMS45MiwzMDIuNDQ1LDIwNS43ODh6IiBmaWxsPSIjNzM5ZGQxIi8+CgkJPC9nPgoJPC9nPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+CjxnPgo8L2c+Cjwvc3ZnPgo=" />
        </div>
        {% if(hotel!=null) %}
        <div id="left_div" style="overflow: scroll;">
            <img src="http://www.bestwestern.fr/public/images/homePage/V2/bgQ60-small.jpg" id="photo_hotel" style="width: 100%;">

            <div class="overlay overlay-bg-black overlay-full" style="position: absolute;left: 0;z-index: 3;width: 100%;background: linear-gradient(to right, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.2));top: 0;">
                <div class="v-center" style="text-align: center;margin-top: 10%;font-family: Verdana">
                    <h3 class="text-overlay text-headline" style="text-shadow: 0 2px 0 rgba(0, 0, 0, 0.8);color: #ffffff;font-family: Verdana;font-size: 1.84rem;font-weight: 400;line-height: 2.46rem;">
                        {{ hotel.name }}
                    </h3>
                    <p class="text-overlay text-subhead" style="text-shadow: none;color: #eeeeee;font-size: 18px;margin-bottom: 20px;">
                        {{ hotel.address }}
                    </p>
                </div>
            </div>
            {% for place in places %}
                <div style="padding: 15px;" class="div_place" data-id="place_btn_{{ place.id }}">
                    <div style="width: 30%; display: inline-block;">
                        <img src="http://www.chateaueza.com/media/hotel-chateau-eza-imageLinkchateau-eza-restaurant11.jpg" style="width: 100%;">
                        <p style="text-align: center; padding-top:5px;">
                            {{ place.avis.count }} avis
                        </p>
                    </div>
                    <div style="width: 65%;display: inline-block;vertical-align:top;padding-left: 10px;">
                        <div>
                            <h5 style="font-family: 'Trebuchet MS'">
                                <img style="height: 7%;" src="{{ asset('assets/image/icons/' ~ place.placeType.icon) }}"/>
                                {{ place.name }}
                                <em style="font-size: 11px;font-family: 'Trebuchet MS';color: #8F8F8F;">{{ place.placeType.name }}</em>
                            </h5>
                        </div>
                        <div style="padding-top: 8px;">
                            <p style=" font-size: 10px;">{{ place.address }}</p>
                            <p style="font-style: italic; font-size: 12px;">{{ place.tel }}</p>
                        </div>

                        <div style="padding-top: 15px;">
                            <p style="font-family: 'Verdana';font-size: 11.5px;text-align: justify;">
                                {{ place.description }}
                            </p>
                        </div>
                    </div>
                    <div class="div_place_btn" id="place_btn_{{ place.id }}" style="text-align: center; padding-top: 15px">
                        <button class="btnForm btnVoirAvis" data-id="{{ place.id }}" id="rechercher">
                            Voir les avis
                        </button>
                    </div>
                </div>
                <hr>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <div style="height: 100%;" id="map"></div>
{% endblock %}


{% block javascript %}
    <script>

        $(".overlay-bg-black").css("height", $("#photo_hotel").height());
        $(".div_place_btn").hide();

        $('#up_btn').on('click', function(){
            $("html, body").animate({ scrollTop: 0 }, "slow");
        });
        $('.div_place').on('hover', function(){
            var id = $(this).attr('data-id');
            $("#"+id).stop();
            $("#"+id).toggle(500);
        } );

        var scroll = $(window).scrollTop();
        if (scroll>260) {
            $('#up_btn').show(300);
        } else {
            $('#up_btn').hide(300);
        }

        $('.btnVoirAvis').click(function(){
            var id = $(this).data('id');
            $.ajax({
                type : 'POST',
                url : '{{  path('popup-avis') }}',
                data: 'place_id='+id,
                success : function(data){
                    $("html, body").animate({ scrollTop: 150 }, "fast");
                    $('#popup').html(data);
                }, error : function(XMLHttpRequest, textStatus, errorThrown) {
                    $('#popup').html('Une erreur est survenue !');
                }
            });
        });

    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>

    {% if hotel %}
        {% set hotelAddress = hotel.address %}
        {% set hotelId = hotel.id %}

        <script>
            function initMap() {
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 8,
                    center: {lat: 48.856614, lng: 2.3522219000000177}
                });

                var geocoder = new google.maps.Geocoder();
                geocodeAddress(geocoder, map);
                setMarkers(map);
            }


            function geocodeAddress(geocoder, resultsMap) {

                var address = "{{ hotelAddress }}";

                geocoder.geocode({'address': address}, function(results, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        resultsMap.setCenter(results[0].geometry.location);
                        resultsMap.setZoom(14);
                        var marker = new google.maps.Marker({
                            map: resultsMap,
                            position: results[0].geometry.location,
                            icon:"{{ asset('assets/image/icons/icon-hotel.png') }}"
                        });

                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });
            }

            function setMarkers(map) {
                var pathOrigin = window.location.origin ;
                var pathIcons  = pathOrigin + '/assets/image/icons/';

                $.ajax({
                    url: pathOrigin + "/app_dev.php/api/hotels/{{ hotelId }}/places.json"
                }).done(function(data) {
                    var places = data.places;

                    for (var i = 0; i < places.length; i++) {
                        var place = places[i];
                        var marker = new google.maps.Marker({
                            position: {lat: place.latitude, lng: place.longitude},
                            map: map,
                            title: place.name,
                            icon: pathIcons + place.type.icon
                        });
//                        marker.addListener('click', function() {
//                            var infowindow = new google.maps.InfoWindow({
//                                content: place.name,
//                                maxWidth: 200
//                            });
//
//                            infowindow.open(map, this);
//                        });
                    }
                });
            }
        </script>
    {% else %}
        <script>
            function initMap() {
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 14,
                    center: {lat: 48.856614, lng: 2.3522219000000177}
                });
            }
        </script>
    {% endif %}


    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC1Wnp3sml8NtilduFMNmjqogvD6wHguWw&callback=initMap">
    </script>
{% endblock %}